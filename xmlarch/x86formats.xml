<?xml version="1.0"?>
<Formats>
	<Field id="segprefix" size="8" shift="0">
		<FieldMatch>
			<RegisterRef idref="es"/>
			<FieldValue>0x26</FieldValue>
		</FieldMatch>
		<FieldMatch>
			<RegisterRef idref="cs"/>
			<FieldValue>0x2e</FieldValue>
		</FieldMatch>
		<FieldMatch>
			<RegisterRef idref="ss"/>
			<FieldValue>0x36</FieldValue>
		</FieldMatch>
		<FieldMatch>
			<RegisterRef idref="ds"/>
			<FieldValue>0x3e</FieldValue>
		</FieldMatch>
		<FieldMatch>
			<RegisterRef idref="fs"/>
			<FieldValue>0x64</FieldValue>
		</FieldMatch>
		<FieldMatch>
			<RegisterRef idref="gs"/>
			<FieldValue>0x65</FieldValue>
		</FieldMatch>
	</Field>

	<ByteSequenceFormat id="basic16">
		<Byte optional="true"><FieldRef idref="segprefix"/></Byte>
		<Byte optional="true">
			<Field id="addrsize" size="8" shift="0">
				<FieldMatch>
					<Number>32</Number>
					<FieldValue>0x67</FieldValue>
				</FieldMatch>
				<FieldMatch>
					<Number>16</Number>
				</FieldMatch>
			</Field>
		</Byte>
		<Byte optional="true">
			<Field id="opersize" size="8" shift="0">
				<FieldMatch>
					<Number>32</Number>
					<FieldValue>0x66</FieldValue>
				</FieldMatch>
				<FieldMatch>
					<Number>16</Number>
				</FieldMatch>
			</Field>
		</Byte>
		<!--<Field id="lockrep" optional="true"></Field>-->
		<Bytes>
			<Field id="opcode"/>
			<Field id="opcode.0.3" offset="0" size="3" shift="0" overwrite="true"/>
		</Bytes>
		<Byte optional="true">
			<Field id="modrm.mod" size="2" shift="6"/>
			<Field id="modrm.reg" size="3" shift="3"/>
			<Field id="modrm.rm" size="3" shift="0"/>
		</Byte>
		<Bytes optional="true">
			<Field id="disp8" size="8" signed="true" exclusive="true"/>
			<Field id="disp16" size="16" signed="true" exclusive="true" endian="little"/>
		</Bytes>
		<Bytes optional="true">
			<Field id="imm8" size="8" signed="false" exclusive="true"/>
			<Field id="imm8s" size="8" signed="true" exclusive="true"/>
			<Field id="imm16" size="16" signed="false" exclusive="true" endian="little"/>
			<Field id="imm16s" size="16" signed="true" exclusive="true" endian="little"/>
		</Bytes>
		<SpecialField id="ea" handler="ea16"/>
	</ByteSequenceFormat>

	<ByteSequenceFormat id="basic32">
		<Byte optional="true"><FieldRef idref="segprefix"/></Byte>
		<Byte optional="true">
			<Field id="addrsize" size="8" shift="0">
				<FieldMatch>
					<Number>16</Number>
					<FieldValue>0x67</FieldValue>
				</FieldMatch>
				<FieldMatch>
					<Number>32</Number>
				</FieldMatch>
			</Field>
		</Byte>
		<Byte optional="true">
			<Field id="opersize" size="8" shift="0">
				<FieldMatch>
					<Number>16</Number>
					<FieldValue>0x66</FieldValue>
				</FieldMatch>
				<FieldMatch>
					<Number>32</Number>
				</FieldMatch>
			</Field>
		</Byte>
		<!--<Field id="lockrep" optional="true"></Field>-->
		<Bytes>
			<Field id="opcode"/>
			<Field id="opcode.0.3" offset="0" size="3" shift="0" overwrite="true"/>
		</Bytes>
		<Byte optional="true">
			<Field id="modrm.mod" size="2" shift="6"/>
			<Field id="modrm.reg" size="3" shift="3"/>
			<Field id="modrm.rm" size="3" shift="0"/>
		</Byte>
		<Byte optional="true">
			<Field id="sib" size="8" shift="0"/>
		</Byte>
		<Bytes optional="true">
			<Field id="disp8" size="8" signed="true" exclusive="true"/>
			<Field id="disp32" size="32" signed="true" exclusive="true" endian="little"/>
		</Bytes>
		<Bytes optional="true">
			<Field id="imm8" size="8" signed="false" exclusive="true"/>
			<Field id="imm8s" size="8" signed="true" exclusive="true"/>
			<Field id="imm16" size="16" signed="false" exclusive="true" endian="little"/>
			<Field id="imm16s" size="16" signed="true" exclusive="true" endian="little"/>
			<Field id="imm32" size="32" signed="false" exclusive="true" endian="little"/>
			<Field id="imm32s" size="32" signed="true" exclusive="true" endian="little"/>
		</Bytes>
		<SpecialField id="ea" handler="ea32"/>
	</ByteSequenceFormat>

	<ByteSequenceFormat id="basic64">
		<Byte optional="true"><FieldRef idref="segprefix"/></Byte>
		<Byte optional="true">
			<Field id="addrsize" size="8" shift="0">
				<FieldMatch>
					<Number>32</Number>
					<FieldValue>0x67</FieldValue>
				</FieldMatch>
				<FieldMatch>
					<Number>64</Number>
				</FieldMatch>
			</Field>
		</Byte>
		<Byte optional="true">
			<Field id="opersize.inner" size="8" shift="0">
				<FieldMatch>
					<Number>16</Number>
					<FieldValue>0x67</FieldValue>
				</FieldMatch>
				<FieldMatch>
					<Number>32</Number>
				</FieldMatch>
			</Field>
		</Byte>
		<!--<Field id="lockrep" optional="true"></Field>-->
		<Byte optional="true">
			<Field id="rex" size="4" shift="4">
				<FieldMatch>
					<Number>1</Number>
					<FieldValue>0x4</FieldValue>
				</FieldMatch>
			</Field>
			<Field id="rex.w" size="1" shift="3"/>
			<Field id="rex.r" size="1" shift="2"/>
			<Field id="rex.x" size="1" shift="1"/>
			<Field id="rex.b" size="1" shift="0"/>
		</Byte>
		<Bytes>
			<Field id="opcode"/>
			<Field id="opcode.0.3" offset="0" size="3" shift="0" overwrite="true"/>
		</Bytes>
		<Byte optional="true">
			<Field id="modrm.mod.inner" size="2" shift="6"/>
			<Field id="modrm.reg.inner" size="3" shift="3"/>
			<Field id="modrm.rm.inner" size="3" shift="0"/>
		</Byte>
		<Byte optional="true">
			<Field id="sib" size="8" shift="0"/>
		</Byte>
		<Bytes optional="true">
			<Field id="disp8" size="8" signed="true" exclusive="true"/>
			<Field id="disp32" size="32" signed="true" exclusive="true" endian="little"/>
			<!-- used only for special mov -->
			<Field id="disp64" size="64" exclusive="true" endian="little"/>
		</Bytes>
		<Bytes optional="true">
			<Field id="imm8" size="8" signed="false" exclusive="true"/>
			<Field id="imm8s" size="8" signed="true" exclusive="true"/>
			<Field id="imm16" size="16" signed="false" exclusive="true" endian="little"/>
			<Field id="imm16s" size="16" signed="true" exclusive="true" endian="little"/>
			<Field id="imm32" size="32" signed="false" exclusive="true" endian="little"/>
			<Field id="imm32s" size="32" signed="true" exclusive="true" endian="little"/>
			<!-- used only for special mov -->
			<Field id="disp64" size="64" exclusive="true" endian="little"/>
		</Bytes>
		<SpecialField id="ea" handler="ea64"/>
		<SpecialField id="modrm.mod" handler="modrm64_mod"/>
		<SpecialField id="modrm.reg" handler="modrm64_reg"/>
		<SpecialField id="modrm.rm" handler="modrm64_rm"/>
		<SpecialField id="opersize" handler="opersize64"/>
	</ByteSequenceFormat>

	<!--
	<Format id="vex3">
		<Bytes>C4</Bytes>
		<Value size="1">
			<Bitfield size="5" shift="0">
				<Field id="vex_mmmmm">
				</Field>
			</Bitfield>
		</Value>
	</Format>

	<Format id="vex2">
		<Bytes>C5</Bytes>
	</Format>
	-->
</Formats>

<!-- vim: set ts=2 sw=2 sts=2 tw=78 noet: -->
